(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{355:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"cryptography"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cryptography"}},[t._v("#")]),t._v(" Cryptography")]),t._v(" "),a("h2",{attrs:{id:"command-examples"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command-examples"}},[t._v("#")]),t._v(" Command Examples")]),t._v(" "),a("p",[t._v("Generate protected RSA private key:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("openssl genrsa -aes128 -out app-server-001-priv.pem "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v("\n")])])]),a("p",[t._v("Get RSA public key:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("openssl rsa -outform PEM -out app-server-001-pub.pem -pubout "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -in app-server-001-priv.pem\n")])])]),a("p",[t._v("Decrypt a ciphertext file")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" string64 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" base64 -d "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" openssl rsautl -decrypt -oaep -out zzz.txt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -inkey /data/digital-key/apps/app-server1.pem\n")])])]),a("p",[t._v("Convert encrypted RSA private key to unencrypted PKCS8 private key (needed for\nWeb Cypto API):")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("openssl pkcs8 -topk8 -inform PEM -outform PEM -nocrypt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -in pkcs1-protected.pem "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  -out pkcs8-unprotected.key\n")])])]),a("p",[t._v("Convert encrypted RSA private key to unencrypted RSA private key:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("openssl rsa -in protected.pem -out unprotected.pem\n")])])]),a("p",[t._v("Show Contents Of An X509 Certificate")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("openssl x509 -in cert1.pem -text -noout\n")])])]),a("h2",{attrs:{id:"mosquitto-jwt-authentication"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mosquitto-jwt-authentication"}},[t._v("#")]),t._v(" Mosquitto JWT Authentication")]),t._v(" "),a("h3",{attrs:{id:"config-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#config-file"}},[t._v("#")]),t._v(" Config File")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("port 1883\nlistener 2883\nprotocol websockets\nauth_plugin /path/to/libmosquitto_jwt_auth.so\nauth_opt_jwt_alg RS256\nauth_opt_jwt_sec_file /path/to/public.der\n")])])]),a("p",[t._v("Use "),a("code",[t._v("jwk2pem.py")]),t._v(" Python script to convert JWK to RSA PEM format.")]),t._v(" "),a("div",{staticClass:"language-python extra-class"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" jwcrypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jwk\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sys\n\nf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"r"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nkey "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" jwcrypto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jwk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("JWK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nf "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sys"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replace"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('".pem"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"w"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("export_to_pem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("private_key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("decode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"utf-8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("close"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("To convert DER file to PEM format:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("openssl rsa -inform DER -outform PEM -pubin -in public.der -out public.pem\n")])])]),a("p",[t._v("To convert PEM file to DER format:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("openssl rsa -inform PEM -outform DER -pubin -in public.pem -out public.der\n")])])]),a("h2",{attrs:{id:"private-certificate-authority-ca"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#private-certificate-authority-ca"}},[t._v("#")]),t._v(" Private Certificate Authority (CA)")]),t._v(" "),a("h3",{attrs:{id:"key-algorithm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#key-algorithm"}},[t._v("#")]),t._v(" Key Algorithm")]),t._v(" "),a("ul",[a("li",[t._v("RSA 2048: This is widely supported by browsers and client. This provides good\nballance between security an efficiency. Default.")]),t._v(" "),a("li",[t._v("RSA 4096: This is less efficient than RSA 2048 and used for root CA.")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Extract public key from x509 certificate")]),t._v("\nopenssl x509 -in cert.pem -keyform PEM -pubkey -noout "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /tmp/pubkey.pem\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Sign a file")]),t._v("\nopenssl dgst -sha256 -sign key.pem -out /tmp/signature.bin data.txt\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Verify a file based on public key and a signature file")]),t._v("\nopenssl dgst -sha256 -verify /tmp/pubkey.pem -signature "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  /tmp/signature.bin data.txt\n")])])])])}),[],!1,null,null,null);s.default=n.exports}}]);