<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Armbian | Technical Documentation</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/tech-docs/assets/css/0.styles.ab8b8f79.css" as="style"><link rel="preload" href="/tech-docs/assets/js/app.dfb115a1.js" as="script"><link rel="preload" href="/tech-docs/assets/js/2.51172f79.js" as="script"><link rel="preload" href="/tech-docs/assets/js/6.9130cd55.js" as="script"><link rel="prefetch" href="/tech-docs/assets/js/10.0b5c1f39.js"><link rel="prefetch" href="/tech-docs/assets/js/11.1707451e.js"><link rel="prefetch" href="/tech-docs/assets/js/12.d8737bf4.js"><link rel="prefetch" href="/tech-docs/assets/js/13.8f6a049e.js"><link rel="prefetch" href="/tech-docs/assets/js/14.670943a7.js"><link rel="prefetch" href="/tech-docs/assets/js/15.1e01142a.js"><link rel="prefetch" href="/tech-docs/assets/js/16.940ede35.js"><link rel="prefetch" href="/tech-docs/assets/js/17.879aff14.js"><link rel="prefetch" href="/tech-docs/assets/js/18.075d1e0c.js"><link rel="prefetch" href="/tech-docs/assets/js/19.59eb65f3.js"><link rel="prefetch" href="/tech-docs/assets/js/20.2bef0596.js"><link rel="prefetch" href="/tech-docs/assets/js/21.fbaa3c96.js"><link rel="prefetch" href="/tech-docs/assets/js/22.7b3e6b4b.js"><link rel="prefetch" href="/tech-docs/assets/js/23.12a2d88c.js"><link rel="prefetch" href="/tech-docs/assets/js/24.998c7ab9.js"><link rel="prefetch" href="/tech-docs/assets/js/25.005bc2bd.js"><link rel="prefetch" href="/tech-docs/assets/js/26.1049df5b.js"><link rel="prefetch" href="/tech-docs/assets/js/27.326561bf.js"><link rel="prefetch" href="/tech-docs/assets/js/28.ac41bf72.js"><link rel="prefetch" href="/tech-docs/assets/js/29.7825b409.js"><link rel="prefetch" href="/tech-docs/assets/js/3.ab45f5d0.js"><link rel="prefetch" href="/tech-docs/assets/js/30.fafc98be.js"><link rel="prefetch" href="/tech-docs/assets/js/31.26eaac52.js"><link rel="prefetch" href="/tech-docs/assets/js/4.a266f6b6.js"><link rel="prefetch" href="/tech-docs/assets/js/5.6bf111ce.js"><link rel="prefetch" href="/tech-docs/assets/js/7.8db61e36.js"><link rel="prefetch" href="/tech-docs/assets/js/8.c6a0dac0.js"><link rel="prefetch" href="/tech-docs/assets/js/9.8cc6a757.js">
    <link rel="stylesheet" href="/tech-docs/assets/css/0.styles.ab8b8f79.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tech-docs/" class="home-link router-link-active"><!----> <span class="site-name">Technical Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/tech-docs/" aria-current="page" class="sidebar-link">Contents</a></li><li><a href="/tech-docs/android.html" class="sidebar-link">Android</a></li><li><a href="/tech-docs/armbian.html" aria-current="page" class="active sidebar-link">Armbian</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech-docs/armbian.html#general" class="sidebar-link">General</a></li><li class="sidebar-sub-header"><a href="/tech-docs/armbian.html#overlay-file-system" class="sidebar-link">Overlay File System</a></li><li class="sidebar-sub-header"><a href="/tech-docs/armbian.html#read-only-armbian" class="sidebar-link">Read-Only Armbian</a></li><li class="sidebar-sub-header"><a href="/tech-docs/armbian.html#manual-armbian-flashing" class="sidebar-link">Manual Armbian Flashing</a></li><li class="sidebar-sub-header"><a href="/tech-docs/armbian.html#using-pwm" class="sidebar-link">Using PWM</a></li><li class="sidebar-sub-header"><a href="/tech-docs/armbian.html#links" class="sidebar-link">Links</a></li><li class="sidebar-sub-header"><a href="/tech-docs/armbian.html#orange-pi-zero-pwm" class="sidebar-link">Orange Pi Zero PWM</a></li><li class="sidebar-sub-header"><a href="/tech-docs/armbian.html#writing-the-u-boot-files-to-sd-card" class="sidebar-link">Writing the u-boot files to SD Card</a></li></ul></li><li><a href="/tech-docs/aws.html" class="sidebar-link">Amazon Web Service</a></li><li><a href="/tech-docs/bluetooth.html" class="sidebar-link">Bluetooth</a></li><li><a href="/tech-docs/cryptography.html" class="sidebar-link">Cryptography</a></li><li><a href="/tech-docs/database.html" class="sidebar-link">Databases</a></li><li><a href="/tech-docs/docker.html" class="sidebar-link">Docker</a></li><li><a href="/tech-docs/electronics.html" class="sidebar-link">Electronics Notes</a></li><li><a href="/tech-docs/git.html" class="sidebar-link">Git Notes</a></li><li><a href="/tech-docs/hardware.html" class="sidebar-link">Hardware</a></li><li><a href="/tech-docs/javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/tech-docs/linux.html" class="sidebar-link">Linux Notes</a></li><li><a href="/tech-docs/ml.html" class="sidebar-link">Machine Learning</a></li><li><a href="/tech-docs/nginx.html" class="sidebar-link">NginX</a></li><li><a href="/tech-docs/programming.html" class="sidebar-link">Programming</a></li><li><a href="/tech-docs/python.html" class="sidebar-link">Python Programming</a></li><li><a href="/tech-docs/rpi.html" class="sidebar-link">Raspberry Pi</a></li><li><a href="/tech-docs/rust.html" class="sidebar-link">Rust Programming Language</a></li><li><a href="/tech-docs/stm32/" class="sidebar-link">STM32</a></li><li><a href="/tech-docs/links.html" class="sidebar-link">Various Links</a></li><li><a href="/tech-docs/vim.html" class="sidebar-link">VIM</a></li><li><a href="/tech-docs/webapp.html" class="sidebar-link">Web Application</a></li><li><a href="/tech-docs/yocto-project.html" class="sidebar-link">Yocto Project</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="armbian"><a href="#armbian" class="header-anchor">#</a> Armbian</h1> <h2 id="general"><a href="#general" class="header-anchor">#</a> General</h2> <h3 id="copy-sd-card-without-dd-of-all-image"><a href="#copy-sd-card-without-dd-of-all-image" class="header-anchor">#</a> Copy SD Card (without <code>dd</code> of all image)</h3> <p>Assuming <code>/dev/sdb</code> is SD card device node in PC</p> <ul><li><code>dd if=Armbian.img of=/dev/sdb bs=1k count=1023</code> -&gt; copy boot sector</li> <li>format <code>/dev/sdb1</code> to <code>ext4</code>.</li> <li>copy files from Armbian.img to <code>/dev/sdb1</code> (use <code>losetup</code> utility to mount it)</li> <li>edit <code>/boot/armbianEnv.txt</code>, set <code>rootdev</code> to <code>/dev/mmcblk0p1</code></li> <li>edit <code>/etc/fstab</code>, set root partition to <code>/dev/mmcblk0p1</code></li></ul> <p>In: <code>/boot/armbian_first_run.txt</code> set IP address of <code>eth0</code> to <code>static</code>.
Use SSH access to this IP address.</p> <p><code>root:1234</code></p> <h2 id="overlay-file-system"><a href="#overlay-file-system" class="header-anchor">#</a> Overlay File System</h2> <div class="language- extra-class"><pre class="language-text"><code># /etc/overlayroot.conf
overlayroot_cfgdisk=&quot;disabled&quot;
overlayroot=&quot;tmpfs:recurse=0&quot;
</code></pre></div><h2 id="read-only-armbian"><a href="#read-only-armbian" class="header-anchor">#</a> Read-Only Armbian</h2> <p>Use <code>virtual read only</code>. On Armbian with recent kernel:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">apt-get</span> <span class="token function">install</span> overlayroot
<span class="token builtin class-name">echo</span> <span class="token string">'overlayroot=&quot;tmpfs&quot;'</span> <span class="token operator">&gt;&gt;</span> /etc/overlayroot.conf
<span class="token function">reboot</span>
</code></pre></div><p>After reboot you can't make any permanent changes unless you use it within:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>overlayroot-chroot
</code></pre></div><p>Overlay is done (with current settings) to RAM which is very fast but small. You can have overlay on any other device.</p> <h3 id="alternative-1"><a href="#alternative-1" class="header-anchor">#</a> Alternative #1</h3> <p>you can use unionfs-fuse, available on debian, that do the same stuff. I'm using it right now on several boards. You have to search on google how to conf it, but basically you need to unite the static and read-only /etc and /var with a temporary rw /etc /var that is mounted as tempfs file system. unionfs do that for you if you configure /usr/local/bin/mount_unionfs with:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> <span class="token string">'[ -z &quot;<span class="token variable">$1</span>&quot; ] &amp;&amp; exit 1 || DIR=<span class="token variable">$1</span>'</span> <span class="token operator">&gt;</span> /usr/local/bin/mount_unionfs
<span class="token builtin class-name">echo</span> <span class="token string">'ROOT_MOUNT=$(grep -v &quot;^#&quot; /etc/fstab | awk '&quot;'&quot;'<span class="token variable">$2</span>==&quot;/&quot; {print substr(<span class="token variable">$4</span>,1,2)}'</span><span class="token string">&quot;'&quot;</span><span class="token string">')'</span> <span class="token operator">&gt;&gt;</span> /usr/local/bin/mount_unionfs
<span class="token builtin class-name">echo</span> <span class="token string">'if [ &quot;<span class="token variable">$ROOT_MOUNT</span>&quot; != &quot;ro&quot; ]; then'</span> <span class="token operator">&gt;&gt;</span> /usr/local/bin/mount_unionfs
<span class="token builtin class-name">echo</span> <span class="token string">'/bin/mount --bind <span class="token variable">${DIR}</span>_org <span class="token variable">${DIR}</span>'</span> <span class="token operator">&gt;&gt;</span> /usr/local/bin/mount_unionfs
<span class="token builtin class-name">echo</span> <span class="token string">'else'</span> <span class="token operator">&gt;&gt;</span> /usr/local/bin/mount_unionfs
<span class="token builtin class-name">echo</span> <span class="token string">'/bin/mount -t tmpfs ramdisk <span class="token variable">${DIR}</span>_rw'</span> <span class="token operator">&gt;&gt;</span> /usr/local/bin/mount_unionfs
<span class="token builtin class-name">echo</span> <span class="token string">'/usr/bin/unionfs-fuse -o cow,allow_other,suid,dev,nonempty <span class="token variable">${DIR}</span>_rw=RW:<span class="token variable">${DIR}</span>_org=RO <span class="token variable">${DIR}</span>'</span> <span class="token operator">&gt;&gt;</span> /usr/local/bin/mount_unionfs
<span class="token builtin class-name">echo</span> <span class="token string">'fi'</span> <span class="token operator">&gt;&gt;</span> /usr/local/bin/mount_unionfs
<span class="token function">chmod</span> +x /usr/local/bin/mount_unionfs
</code></pre></div><p>and then switch to ro the partitions and add on fstab</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mount_unionfs /etc fuse defaults <span class="token number">0</span> <span class="token number">0</span>
mount_unionfs /var fuse defaults <span class="token number">0</span> <span class="token number">0</span>
</code></pre></div><p>before it you need to create those 2 direcories and copy the static /etc and /var on them, you can do that by:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cp</span> -al /etc /etc_org
<span class="token function">mv</span> /var /var_org
<span class="token function">mkdir</span> /etc_rw
<span class="token function">mkdir</span> /var /var_rw
</code></pre></div><h3 id="solution-2"><a href="#solution-2" class="header-anchor">#</a> Solution #2</h3> <p>Solution for overlayroot in Armbian Jessie:</p> <ol><li>install <code>overlayroot_0.27ubuntu1.4_all.deb</code></li></ol> <div class="language- extra-class"><pre class="language-text"><code>dpkg -i overlayroot_0.27ubuntu1.4_all.deb
</code></pre></div><ol start="2"><li>add following lines to /usr/share/initramfs-tools/hooks/overlayroot file:</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code>copy_exec /bin/grep /bin
copy_exec /usr/bin/stat /bin
copy_exec /bin/echo /bin
</code></pre></div><p>This will load missing tools required by /usr/share/initramfs-tools/scripts/init-bottom/overlayroot script.</p> <ol start="3"><li><p>replace all &quot;mount --move&quot; with &quot;mount -o move&quot; in /usr/share/initramfs-tools/scripts/init-bottom/overlayroot file.</p></li> <li><p>update-initramfs -u</p></li></ol> <h3 id="references"><a href="#references" class="header-anchor">#</a> References</h3> <ul><li><a href="https://github.com/lauhub/debian-to-readonly" target="_blank" rel="noopener noreferrer">Link #1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://wiki.debian.org/ReadonlyRoot" target="_blank" rel="noopener noreferrer">Link #2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://bykting.wordpress.com/tag/raspberry-sd-card-read-only-root-file-system/" target="_blank" rel="noopener noreferrer">Link #3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://help.ubuntu.com/community/aufsRootFileSystemOnUsbFlash" target="_blank" rel="noopener noreferrer">Link #4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://wiki.archlinux.org/index.php/Overlay_filesystem" target="_blank" rel="noopener noreferrer">Link #5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="manual-armbian-flashing"><a href="#manual-armbian-flashing" class="header-anchor">#</a> Manual Armbian Flashing</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>Armbian_5.65_Orangepizero_Ubuntu_bionic_next_4.14.78.img <span class="token punctuation">\</span>
  <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/mmcblk0 <span class="token assign-left variable">bs</span><span class="token operator">=</span>1k <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">1023</span>
</code></pre></div><p>Format <code>/dev/mmcblk0p1</code> to ext4 file system</p> <p><code>fdisk -l Armbian_5.65_Orangepizero_Ubuntu_bionic_next_4.14.78.img</code></p> <p>Note first partition offset in the Armbian image file</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> losetup <span class="token punctuation">\</span>
  /dev/loop0 Armbian_5.65_Orangepizero_Ubuntu_bionic_next_4.14.78.img <span class="token punctuation">\</span>
  -o <span class="token variable"><span class="token variable">$((</span><span class="token number">512</span><span class="token operator">*</span><span class="token number">8192</span><span class="token variable">))</span></span>
</code></pre></div><p>Mount <code>/dev/loop0</code></p> <p>Copy all files from mounted <code>/dev/loop0</code> to <code>/dev/mmcblk0p1</code></p> <p>In <code>/dev/mmcblk0p1</code>:</p> <ul><li>Edit <code>/boot/armbianEnv.txt</code>, set root to <code>/dev/mmcblk0p1</code></li> <li>Edit <code>/etc/fstab</code>, seto root to <code>/dev/mmcblk0p1</code></li></ul> <p>Boot OrangePi Zero. Find its IP address.</p> <p>Using ssh, connect to OrangePi Zero using username=root and password=1234</p> <p>Changer root password immediately.</p> <p>Run <code>armbian-config</code> to customize timezone, keyboard, language, etc.</p> <p>To activate SPI add following lines to the /boot/armbianEnv.txt</p> <div class="language- extra-class"><pre class="language-text"><code>overlays=spi-spidev
param_spidev_spi_bus=1
</code></pre></div><p>To activate PWM,  add following lines to the /boot/armbianEnv.txt
<code>overlays=pwm</code></p> <h2 id="using-pwm"><a href="#using-pwm" class="header-anchor">#</a> Using PWM</h2> <ul><li><code>cd /sys/class/pwm/pwmchip0</code></li> <li><code>echo 0 | sudo tee export</code> to export PWM0 sysfs file.</li> <li><code>echo normal | sudo tee polarity</code> to set PWM polarity to normal.</li> <li><code>echo 1000000000 | sudo tee period</code> to set PWM period.</li> <li><code>echo 100000000 | sudo tee duty_cycle</code> to set duty cycle.</li> <li><code>echo 1 | sudo tee enable</code> to start PWM toggling.</li> <li><code>echo 0 | sudo tee enable</code> to stop PWM toggling.</li></ul> <h2 id="links"><a href="#links" class="header-anchor">#</a> Links</h2> <ul><li>http://esp8266-server.de/OrangePi/</li></ul> <h2 id="orange-pi-zero-pwm"><a href="#orange-pi-zero-pwm" class="header-anchor">#</a> Orange Pi Zero PWM</h2> <p>When stopping PWM but LED is HIGH, then set POLARITY to INVERSED.</p> <h2 id="writing-the-u-boot-files-to-sd-card"><a href="#writing-the-u-boot-files-to-sd-card" class="header-anchor">#</a> Writing the u-boot files to SD Card</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/usr/local/share/u-boot/u-boot-<span class="token operator">&lt;</span>portname<span class="token operator">&gt;</span>/sunxi-spl.bin <span class="token punctuation">\</span>
  <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/sd_card_device <span class="token assign-left variable">bs</span><span class="token operator">=</span><span class="token number">1024</span> <span class="token assign-left variable">seek</span><span class="token operator">=</span><span class="token number">8</span>

<span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/usr/local/share/u-boot/u-boot-<span class="token operator">&lt;</span>portname<span class="token operator">&gt;</span>/u-boot.img <span class="token assign-left variable">conv</span><span class="token operator">=</span>notrunc,sync <span class="token punctuation">\</span>
  <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/sd_card_device <span class="token assign-left variable">bs</span><span class="token operator">=</span><span class="token number">1024</span> <span class="token assign-left variable">seek</span><span class="token operator">=</span><span class="token number">40</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tech-docs/android.html" class="prev">
        Android
      </a></span> <span class="next"><a href="/tech-docs/aws.html">
        Amazon Web Service
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/tech-docs/assets/js/app.dfb115a1.js" defer></script><script src="/tech-docs/assets/js/2.51172f79.js" defer></script><script src="/tech-docs/assets/js/6.9130cd55.js" defer></script>
  </body>
</html>
