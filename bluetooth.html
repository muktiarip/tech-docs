<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bluetooth | Technical Documentation</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="">
    <link rel="preload" href="/tech-docs/assets/css/0.styles.ab8b8f79.css" as="style"><link rel="preload" href="/tech-docs/assets/js/app.dfb115a1.js" as="script"><link rel="preload" href="/tech-docs/assets/js/2.51172f79.js" as="script"><link rel="preload" href="/tech-docs/assets/js/8.c6a0dac0.js" as="script"><link rel="prefetch" href="/tech-docs/assets/js/10.0b5c1f39.js"><link rel="prefetch" href="/tech-docs/assets/js/11.1707451e.js"><link rel="prefetch" href="/tech-docs/assets/js/12.d8737bf4.js"><link rel="prefetch" href="/tech-docs/assets/js/13.8f6a049e.js"><link rel="prefetch" href="/tech-docs/assets/js/14.670943a7.js"><link rel="prefetch" href="/tech-docs/assets/js/15.1e01142a.js"><link rel="prefetch" href="/tech-docs/assets/js/16.940ede35.js"><link rel="prefetch" href="/tech-docs/assets/js/17.879aff14.js"><link rel="prefetch" href="/tech-docs/assets/js/18.075d1e0c.js"><link rel="prefetch" href="/tech-docs/assets/js/19.59eb65f3.js"><link rel="prefetch" href="/tech-docs/assets/js/20.2bef0596.js"><link rel="prefetch" href="/tech-docs/assets/js/21.fbaa3c96.js"><link rel="prefetch" href="/tech-docs/assets/js/22.7b3e6b4b.js"><link rel="prefetch" href="/tech-docs/assets/js/23.12a2d88c.js"><link rel="prefetch" href="/tech-docs/assets/js/24.998c7ab9.js"><link rel="prefetch" href="/tech-docs/assets/js/25.005bc2bd.js"><link rel="prefetch" href="/tech-docs/assets/js/26.1049df5b.js"><link rel="prefetch" href="/tech-docs/assets/js/27.326561bf.js"><link rel="prefetch" href="/tech-docs/assets/js/28.ac41bf72.js"><link rel="prefetch" href="/tech-docs/assets/js/29.7825b409.js"><link rel="prefetch" href="/tech-docs/assets/js/3.ab45f5d0.js"><link rel="prefetch" href="/tech-docs/assets/js/30.fafc98be.js"><link rel="prefetch" href="/tech-docs/assets/js/31.26eaac52.js"><link rel="prefetch" href="/tech-docs/assets/js/4.a266f6b6.js"><link rel="prefetch" href="/tech-docs/assets/js/5.6bf111ce.js"><link rel="prefetch" href="/tech-docs/assets/js/6.9130cd55.js"><link rel="prefetch" href="/tech-docs/assets/js/7.8db61e36.js"><link rel="prefetch" href="/tech-docs/assets/js/9.8cc6a757.js">
    <link rel="stylesheet" href="/tech-docs/assets/css/0.styles.ab8b8f79.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tech-docs/" class="home-link router-link-active"><!----> <span class="site-name">Technical Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/tech-docs/" aria-current="page" class="sidebar-link">Contents</a></li><li><a href="/tech-docs/android.html" class="sidebar-link">Android</a></li><li><a href="/tech-docs/armbian.html" class="sidebar-link">Armbian</a></li><li><a href="/tech-docs/aws.html" class="sidebar-link">Amazon Web Service</a></li><li><a href="/tech-docs/bluetooth.html" aria-current="page" class="active sidebar-link">Bluetooth</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech-docs/bluetooth.html#bluetooth-receive-pairing-request-without-gui" class="sidebar-link">Bluetooth Receive Pairing Request without GUI</a></li><li class="sidebar-sub-header"><a href="/tech-docs/bluetooth.html#bluetooth-pairing-in-raspberry-pi" class="sidebar-link">Bluetooth Pairing In Raspberry Pi</a></li><li class="sidebar-sub-header"><a href="/tech-docs/bluetooth.html#bluetooth-accepting-pairing-request-with-cli" class="sidebar-link">Bluetooth Accepting Pairing Request with CLI</a></li><li class="sidebar-sub-header"><a href="/tech-docs/bluetooth.html#ble-get-notification-in-shell" class="sidebar-link">BLE - Get Notification In Shell</a></li><li class="sidebar-sub-header"><a href="/tech-docs/bluetooth.html#python-code-for-bluetooth-thermal-printer" class="sidebar-link">Python Code For Bluetooth Thermal Printer</a></li><li class="sidebar-sub-header"><a href="/tech-docs/bluetooth.html#cli-bluetooth-pairing-rpi-headless" class="sidebar-link">CLI Bluetooth Pairing (RPi Headless)</a></li><li class="sidebar-sub-header"><a href="/tech-docs/bluetooth.html#bluetooth-serial-port-server" class="sidebar-link">Bluetooth serial port server:</a></li><li class="sidebar-sub-header"><a href="/tech-docs/bluetooth.html#misc-1" class="sidebar-link">Misc 1</a></li></ul></li><li><a href="/tech-docs/cryptography.html" class="sidebar-link">Cryptography</a></li><li><a href="/tech-docs/database.html" class="sidebar-link">Databases</a></li><li><a href="/tech-docs/docker.html" class="sidebar-link">Docker</a></li><li><a href="/tech-docs/electronics.html" class="sidebar-link">Electronics Notes</a></li><li><a href="/tech-docs/git.html" class="sidebar-link">Git Notes</a></li><li><a href="/tech-docs/hardware.html" class="sidebar-link">Hardware</a></li><li><a href="/tech-docs/javascript.html" class="sidebar-link">JavaScript</a></li><li><a href="/tech-docs/linux.html" class="sidebar-link">Linux Notes</a></li><li><a href="/tech-docs/ml.html" class="sidebar-link">Machine Learning</a></li><li><a href="/tech-docs/nginx.html" class="sidebar-link">NginX</a></li><li><a href="/tech-docs/programming.html" class="sidebar-link">Programming</a></li><li><a href="/tech-docs/python.html" class="sidebar-link">Python Programming</a></li><li><a href="/tech-docs/rpi.html" class="sidebar-link">Raspberry Pi</a></li><li><a href="/tech-docs/rust.html" class="sidebar-link">Rust Programming Language</a></li><li><a href="/tech-docs/stm32/" class="sidebar-link">STM32</a></li><li><a href="/tech-docs/links.html" class="sidebar-link">Various Links</a></li><li><a href="/tech-docs/vim.html" class="sidebar-link">VIM</a></li><li><a href="/tech-docs/webapp.html" class="sidebar-link">Web Application</a></li><li><a href="/tech-docs/yocto-project.html" class="sidebar-link">Yocto Project</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="bluetooth"><a href="#bluetooth" class="header-anchor">#</a> Bluetooth</h1> <h2 id="bluetooth-receive-pairing-request-without-gui"><a href="#bluetooth-receive-pairing-request-without-gui" class="header-anchor">#</a> Bluetooth Receive Pairing Request without GUI</h2> <p>The bluetoothctl daemon deals with incoming pairing request, scanning etc and
the same are made by the Bluetooth GUI. If you remove from the GUI the
Bluetooth stuff (right click on the icon and then remove) and then open a
terminal and run:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>bluetoothctl
agent NoInputNoOutput
</code></pre></div><p>incoming pairing request will be automatically accepted.</p> <p>As countercheck, before removing your Bluetooth GUI if you run the
aforementioned commands without accepting on the pop-up dialog you should see
Paired: yes in the log.</p> <h2 id="bluetooth-pairing-in-raspberry-pi"><a href="#bluetooth-pairing-in-raspberry-pi" class="header-anchor">#</a> Bluetooth Pairing In Raspberry Pi</h2> <p>Since bluetooth-agent command doesn't exist on Jessie, the modern way is to
pipe relevant commands to bluetoothctl. Based on this SO question, the
following script should enable automatic pairing without manual pin entry:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> bluetoothctl <span class="token operator">&lt;&lt;</span><span class="token string">EOF
power on
discoverable on
pairable on
agent NoInputNoOutput
default-agent 
EOF</span>
</code></pre></div><h2 id="bluetooth-accepting-pairing-request-with-cli"><a href="#bluetooth-accepting-pairing-request-with-cli" class="header-anchor">#</a> Bluetooth Accepting Pairing Request with CLI</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>hciconfig hci0 up
hciconfig hci0 sspmode <span class="token number">1</span>
hciconfig hci0 piscan
<span class="token function">sudo</span> bluetooth-agent <span class="token number">1234</span>
</code></pre></div><ul><li><a href="https://www.kynetics.com/docs/2018/pairing_agents_bluez/" target="_blank" rel="noopener noreferrer">Reference1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://raspberrypi.stackexchange.com/questions/50496/automatically-accept-bluetooth-pairings" target="_blank" rel="noopener noreferrer">Reference2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.raspberrypi.org/forums/viewtopic.php?p=955425#p955425" target="_blank" rel="noopener noreferrer">Reference3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/DrRowland/RPi-Bluetooth-Console" target="_blank" rel="noopener noreferrer">Reference4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> hciconfig hci0 up
<span class="token function">sudo</span> hciconfig hci0 piscan
<span class="token function">sudo</span> <span class="token function">mknod</span> -m <span class="token number">666</span> /dev/rfcomm0 c <span class="token number">216</span> <span class="token number">0</span>
<span class="token function">sudo</span> rfcomm <span class="token function">watch</span> /dev/rfcomm0 <span class="token number">10</span> <span class="token function">cat</span> /dev/rfcomm0
</code></pre></div><h2 id="ble-get-notification-in-shell"><a href="#ble-get-notification-in-shell" class="header-anchor">#</a> BLE - Get Notification In Shell</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>$<span class="token operator">&gt;</span> <span class="token function">sudo</span> hcitool lescan
$<span class="token operator">&gt;</span> gatttool -I -b <span class="token variable">${BT_ADDRESS}</span>
<span class="token punctuation">[</span>LE<span class="token punctuation">]</span><span class="token operator">&gt;</span> connect
<span class="token comment"># Show services. Note attr handle (start and end)</span>
<span class="token punctuation">[</span>LE<span class="token punctuation">]</span><span class="token operator">&gt;</span> primary
<span class="token comment"># We are interested in a service with handle 0x0028 through 0x002b</span>
<span class="token comment"># Discover characteristic descriptors. Note for UUID 2902 (notification)</span>
<span class="token punctuation">[</span>LE<span class="token punctuation">]</span><span class="token operator">&gt;</span> char-desc <span class="token number">28</span> 2b
<span class="token comment"># We got handle 0x002b for UUID 2902</span>
<span class="token comment"># Enable notification</span>
<span class="token punctuation">[</span>LE<span class="token punctuation">]</span><span class="token operator">&gt;</span> char-write-req 2b 0100
<span class="token comment"># Disable notification</span>
<span class="token punctuation">[</span>LE<span class="token punctuation">]</span><span class="token operator">&gt;</span> char-write-req 2b 0000
<span class="token punctuation">[</span>LE<span class="token punctuation">]</span><span class="token operator">&gt;</span> disconnect
<span class="token punctuation">[</span>LE<span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exit</span>
</code></pre></div><h2 id="python-code-for-bluetooth-thermal-printer"><a href="#python-code-for-bluetooth-thermal-printer" class="header-anchor">#</a> Python Code For Bluetooth Thermal Printer</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> bluetooth <span class="token keyword">import</span> <span class="token operator">*</span>

_uuid <span class="token operator">=</span> <span class="token string">&quot;00001101-0000-1000-8000-00102345678&quot;</span>
_addr <span class="token operator">=</span> <span class="token string">&quot;8C:De:DA:52:C4:CE&quot;</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'escpos-payload.bin'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

sm <span class="token operator">=</span> find_service<span class="token punctuation">(</span>uuid<span class="token operator">=</span>_uuid<span class="token punctuation">,</span> address<span class="token operator">=</span>_addr<span class="token punctuation">)</span>
<span class="token comment"># sm -&gt; [{'service-classes': ['1101'], 'profiles': [('1101', 256)], 'name': 'SerialPort', 'description': None, 'provider': None, 'service-id': None, 'protocol': 'RFCOMM', 'port': 6, 'host': '8C:De:52:DA:CE:C4'}]</span>
_host <span class="token operator">=</span> sm<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'host'</span><span class="token punctuation">]</span>
_port <span class="token operator">=</span> sm<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'port'</span><span class="token punctuation">]</span>
_name <span class="token operator">=</span> sm<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>
sock <span class="token operator">=</span> BluetoothSocket<span class="token punctuation">(</span>RFCOMM<span class="token punctuation">)</span>
sock<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>_host<span class="token punctuation">,</span> _port<span class="token punctuation">)</span><span class="token punctuation">)</span>
sock<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
sock<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="cli-bluetooth-pairing-rpi-headless"><a href="#cli-bluetooth-pairing-rpi-headless" class="header-anchor">#</a> CLI Bluetooth Pairing (RPi Headless)</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> systemctl start bluetooth
<span class="token function">sudo</span> bluetoothctl

<span class="token comment">#BluetoothCtl&gt; scan</span>
<span class="token comment">#BluetoothCtl&gt; pair 12:34:56:78:90:ab</span>
<span class="token comment">#BluetoothCtl&gt; quit</span>
</code></pre></div><h2 id="bluetooth-serial-port-server"><a href="#bluetooth-serial-port-server" class="header-anchor">#</a> Bluetooth serial port server:</h2> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment">#sdptool add --channel=3 SP</span>
<span class="token comment">#rfcomm listen /dev/rfcomm0 3</span>
</code></pre></div><p>Don't use channel 1! It wont work.</p> <h2 id="misc-1"><a href="#misc-1" class="header-anchor">#</a> Misc 1</h2> <p>BLE Beacon problems?
https://www.brooklynmuseum.org/community/blogosphere/2015/02/04/the-realities-of-installing-ibeacon-to-scale/</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> hcitool -i hci0 cmd 0x08 0x0006 a0 00 a0 00 03 00 00 00 00 00 00 00 00 07 00
<span class="token function">sudo</span> hcitool -i hci0 cmd 0x08 0x0008 1E 02 01 1A 1A FF 4C 00 02 <span class="token number">15</span> FB 0B <span class="token number">57</span> A2 <span class="token number">82</span> <span class="token number">28</span> <span class="token number">44</span> CD <span class="token number">91</span> 3A <span class="token number">94</span> A1 <span class="token number">22</span> BA <span class="token number">12</span> 06 00 01 00 02 D1 00
<span class="token function">sudo</span> hcitool -i hci0 cmd 0x08 0x000a 01
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tech-docs/aws.html" class="prev">
        Amazon Web Service
      </a></span> <span class="next"><a href="/tech-docs/cryptography.html">
        Cryptography
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/tech-docs/assets/js/app.dfb115a1.js" defer></script><script src="/tech-docs/assets/js/2.51172f79.js" defer></script><script src="/tech-docs/assets/js/8.c6a0dac0.js" defer></script>
  </body>
</html>
